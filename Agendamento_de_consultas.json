{
  "name": "Agendamento de consultas",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -360,
        -160
      ],
      "id": "b98cd1e5-c6a4-41ba-a4fa-7c2b0acefd00",
      "name": "When chat message received",
      "webhookId": "81dab34f-159b-4430-a4c5-088db7d1e41a"
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $now }}",
        "format": "custom",
        "customFormat": "EEEE, MMMM dd yyyy 'at' hh:mm:ss",
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -160,
        -160
      ],
      "id": "b84d6da5-b01b-4996-a172-566d19e71a1b",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('When chat message received').item.json.chatInput }}",
        "options": {
          "systemMessage": "=Voc√™ √© um assistente virtual de atendimento especializado em uma cl√≠nica odontol√≥gica. Sua fun√ß√£o principal √© tirar d√∫vidas dos pacientes sobre os servi√ßos oferecidos pela cl√≠nica, fornecer informa√ß√µes claras e precisas e auxiliar no agendamento de consultas diretamente em uma agenda integrada (tool). Voc√™ deve ser cordial, profissional e r√°pido nas respostas.\n\nExemplo de Di√°logo:\n\n1. Perguntas Frequentes\n\nUsu√°rio: Quais servi√ßos odontol√≥gicos voc√™s oferecem?\nAssistente: Ol√°! Oferecemos diversos servi√ßos, incluindo limpeza dent√°ria, clareamento, ortodontia (aparelhos), implantes, restaura√ß√µes e tratamentos de canal. Se precisar de mais detalhes sobre algum deles, √© s√≥ perguntar! üòä\n\nUsu√°rio: Voc√™s atendem crian√ßas?\nAssistente: Sim! Temos profissionais especializados em odontopediatria para cuidar da sa√∫de bucal das crian√ßas com muito carinho. Posso ajudar a agendar uma consulta?\n\n2. Agendamento de Consultas\n\nUsu√°rio: Quero marcar uma consulta.\nAssistente: Claro! Qual seria a melhor data e hor√°rio para voc√™? Temos disponibilidade para esta semana.\n\n3. Resolu√ß√£o de D√∫vidas\n\nUsu√°rio: Quanto custa o clareamento dental?\nAssistente: O clareamento dental custa a partir de R$ 500, dependendo do tipo de procedimento (consult√≥rio ou caseiro). Podemos agendar uma avalia√ß√£o gratuita para verificar o melhor tratamento para voc√™.\n\nUsu√°rio: Preciso de documenta√ß√£o para a consulta?\nAssistente: Para a primeira consulta, pedimos apenas um documento de identifica√ß√£o com foto. Se tiver exames recentes, pode traz√™-los tamb√©m, mas n√£o √© obrigat√≥rio.\n\n\n\nHoje √©: {{ $now }}\n\nPara novo agendamento:\n\nSolicite o nome, servi√ßo e data/hora (Ex: 01/01/2024 18hs) do agendamento.\n\nAo receber todos os dados, verificar se h√° disponibilidade na agenda. Se sim, fa√ßa o agendamento com intervalo de 1 hora. Do contr√°rio, informe que essa data/hora n√£o est√° dispon√≠vel.\n\nPara reagendamento:\n\nSolicite o nome e servi√ßo do atual agendamento.\n\nSe o agendamento for localizado, solicitar a data/hora do reagendamento.\n\nAo receber a nova data e hora, verificar se h√° disponibilidade na agenda. Se sim, fa√ßa o reagendamento para a nova data e hora com intervalo de 1 hora. Do contr√°rio, informe que essa data e hora n√£o est√° dispon√≠vel.\n\nPara exclus√£o de agendamento:\n\nSolicite o nome e servi√ßo do atual agendamento.\n\nSe o agendamento for localizado, exclua-o. Do contr√°rio, informe que o agendamento n√£o foi localizado.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        60,
        -160
      ],
      "id": "52498b07-572f-4944-b92c-0d447e26576c",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        -80,
        40
      ],
      "id": "19c32029-dab2-48d9-a9f7-0978b2081a4e",
      "name": "Groq Chat Model",
      "credentials": {
        "groqApi": {
          "id": "irQEynKRCLnyaWqQ",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        80,
        60
      ],
      "id": "78778ae1-5c89-4746-bbc9-5f0bfc366c0b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "c332ec88a08ed2f20d05641c37b1ee02ba3be608da53f234241bd57081b2fe6c@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamento IA"
        },
        "start": "={{ $fromAI(\"Start_Time\", \"Horario inicial do evento ex.:2024-10-08 00:00:00\") }}",
        "end": "={{ $fromAI(\"End_Time\", \"Horario final do evento ex.:2024-10-08 00:10:00\") }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        220,
        60
      ],
      "id": "f6f00d01-a2c1-405a-b6d2-76898eeb272c",
      "name": "Agendar Consulta",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "pWStCazUScYfZ1wK",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "c332ec88a08ed2f20d05641c37b1ee02ba3be608da53f234241bd57081b2fe6c@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamento IA"
        },
        "timeMin": "={{ $fromAI(\"Initial_DateTime\", \"Data e hora inicial da consulta ex.:2024-10-08 00:00:00\") }}",
        "timeMax": "={{ $fromAI(\"Final_DateTime\", \"Data e hora final da consulta ex.:2024-10-08 00:00:00\") }}",
        "options": {
          "timeZone": {
            "__rl": true,
            "value": "America/Sao_Paulo",
            "mode": "list",
            "cachedResultName": "America/Sao_Paulo"
          }
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        360,
        60
      ],
      "id": "d50fd728-32a1-4ffc-9fac-1f1f6fc1e518",
      "name": "Buscar Consulta",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "pWStCazUScYfZ1wK",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "c332ec88a08ed2f20d05641c37b1ee02ba3be608da53f234241bd57081b2fe6c@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamento IA"
        },
        "eventId": "={{ $fromAI(\"Event_ID\", \"ID do evento que deve ser excluido\") }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        500,
        60
      ],
      "id": "3b447958-4215-4328-a31d-d2b8226f0de8",
      "name": "Cancelar Consulta",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "pWStCazUScYfZ1wK",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Agendar Consulta": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Consulta": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar Consulta": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1ecfea3b-c5d5-40af-b4b5-c165c0400d5b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "64dd923f88ba57d6f3fddd6c37ba2edcee794fbc612d1859e201b406453ff6a0"
  },
  "id": "GKZqsgjEufygdfI9",
  "tags": []
}